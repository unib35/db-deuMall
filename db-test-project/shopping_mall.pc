// 작성자 : 이종민
// shopping_mall.pc
#define _CRT_SECURE_NO_WARNINGS
//-----------------------------------------

#include <stdlib.h>
#include <stdio.h>
#include <ctype.h>
#include <string.h>
#include <conio.h>

/* for oracle */
#include <sqlda.h>
#include <sqlca.h>
#include <sqlcpr.h>


// win32 Visual C 2010 이상컴파일시 추가
#define getch() _getch()
//-----------------------------------------

/*---------------  화면 커서 위치 제어 ----------------------*/
#include < windows.h >
void gotoxy(int x, int y) ;
void getxy(int *x, int *y) ;
void clrscr(void) ;
/*-----------------------------------------------------------*/

void init();
void select_init();

extern void login();
extern cusorControl();
extern void createAccount();
void sql_error();

EXEC SQL BEGIN DECLARE SECTION;
	VARCHAR uid[80];
	VARCHAR pwd[20];
EXEC SQL END DECLARE SECTION;

#define getch() _getch()
#define LOGIN_SUCCESS 1
#define DOWN_KEY 80
#define UP_KEY 72
#define ENTER_KEY 13
#define LOGIN_BUTTON 20
#define CREATE_ACCOUNT_BUTTON 22
#define EXIT_BUTTON 24

void init()
{
	_putenv("NLS_LANG=American_America.KO16KSC5601"); //한글사용
	DB_connect();
	select_init();
	EXEC SQL COMMIT WORK RELEASE ;
	getch();
}

void select_init()
{
	clrscr(); 
	int isLoginFailed = 0;
	while(1){
		clrscr();
		gotoxy(0, 1);
		print_screen("shopping_mall_screen.txt");

		gotoxy(34, 20); // 버튼 선택으로 이동
		
		int arrIndex = 0;
		int buttonYPosition[] = {20, 22, 24};
		int inputKey;
		
		while(1){
			inputKey  = _getch();
			if(inputKey == ENTER_KEY){
				break;				
			}
			else if(inputKey == DOWN_KEY){
				arrIndex = cursorControl(buttonYPosition, sizeof(buttonYPosition) / sizeof(buttonYPosition[0]), arrIndex, DOWN_KEY);
				gotoxy(34, buttonYPosition[arrIndex]);
			}
			else if(inputKey == UP_KEY){
				arrIndex = cursorControl(buttonYPosition, sizeof(buttonYPosition) / sizeof(buttonYPosition[0]), arrIndex, UP_KEY);
				gotoxy(34, buttonYPosition[arrIndex]);
			}		
		}

		for (;;) {
			clrscr();
			switch(buttonYPosition[arrIndex]){
				case LOGIN_BUTTON:
					login();
					break;
				case CREATE_ACCOUNT_BUTTON:
					createAccount();
					break;
				case EXIT_BUTTON:
					exit(0);
			}
		}
	}
	
}

